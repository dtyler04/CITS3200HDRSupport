{% extends "base.html" %}
{% block title %}Admin Dashboard{% endblock %}
{% block content %}
                <body>
                <div class="container mt-5">
                        <h2>Admin Dashboard</h2>
                        <!-- Nav tabs -->
                        <ul class="nav nav-tabs" id="adminTab" role="tablist">
                                <li class="nav-item" role="presentation">
                                        <button class="nav-link active" id="email-tab" data-bs-toggle="tab" data-bs-target="#email" type="button" role="tab" aria-controls="email" aria-selected="true">Email Editor</button>
                                </li>
                                <!-- Add more tabs here -->
                        </ul>
                        <!-- Tab panes -->
                        <div class="tab-content mt-3">
                                <div class="tab-pane fade show active" id="email" role="tabpanel" aria-labelledby="email-tab">
                                        <h4>Create / Manage Emails</h4>
                                        <div id="email-action-buttons" class="d-flex justify-content-center gap-4 mt-4">
                                                <button id="newMessageBtn" class="btn btn-success btn-lg">Make New Message</button>
                                                <button id="openMessageBtn" class="btn btn-primary btn-lg">Open Existing Message</button>
                                        </div>
                                        <div id="email-editor-container" style="display:none;">
                                                {% include "email_editor.html" %}
                                        </div>
                                        <div id="select-message-section" style="display:none;">
                                                {% set messages = messages %}
                                                {% include "select_message.html" %}
                                        </div>
                                        <div id="email-editor-section" style="display:none;">
                                                <!-- Your email editor form goes here -->
                                        </div>
                                        <script>
                                                // new button is the "Make New Message" button
                                                const newBtn = document.getElementById('newMessageBtn');
                                                //Oppen is the Open a saved message button.
                                                const openBtn = document.getElementById('openMessageBtn');
                                                const btns = document.getElementById('email-action-buttons');
                                                const editor = document.getElementById('email-editor-container');
                                                const list = document.getElementById('select-message-section');
                                                newBtn.onclick = function() {
                                                        btns.style.display = 'none';
                                                        btns.style.visibility = 'hidden';
                                                        btns.classList.add('d-none');
                                                        editor.style.display = 'block';
                                                        editor.style.opacity = 1;
                                                        
                                                        // Set the initial content for new messages
                                                        setTimeout(() => {
                                                                if (window.editorInstance) {
                                                                        console.log('Setting editor data...');
                                                                        window.editorInstance.setData('<p>This is a new editor! Please don\'t forget to save me!</p>');
                                                                } else {
                                                                        console.log('Editor instance not found, trying alternative access...');
                                                                        // Try to find the editor instance another way
                                                                        const editorElement = document.querySelector('#editor');
                                                                        if (editorElement && editorElement.ckeditorInstance) {
                                                                                editorElement.ckeditorInstance.setData('<p>This is a new editor! Please don\'t forget to save me!</p>');
                                                                        }
                                                                }
                                                        }, 100);
                                                };
                                                openBtn.onclick = function() {
                                                        btns.style.display = 'none';
                                                        btns.style.visibility = 'hidden';
                                                        btns.classList.add('d-none');
                                                        list.style.display = 'block';
                                                        list.style.opacity = 1;
                                                };
                                        </script>
                                </div>
                                <!-- Add more tab panes here -->
                        </div>
                </div>
                <script src="{{ url_for('static', filename='detectmobilebroswer.js')}}"></script>
                <script>
                document.addEventListener('DOMContentLoaded', function() {
                document.querySelectorAll('.edit-btn').forEach(function(btn) {
                        btn.addEventListener('click', function() {
                        console.log('Edit button clicked');
                        console.log('Message ID:', btn.getAttribute('data-message-id'));
                        console.log('Message Content:', btn.getAttribute('data-message-content'));
                        console.log('Degree Code:', btn.getAttribute('data-degree-code'));
                        console.log('Week Released:', btn.getAttribute('data-week-released'));
                        
                        // Hide the select message table
                        document.getElementById('select-message-section').style.display = 'none';
                        // Show the email editor container (not email-editor-section)
                        document.getElementById('email-editor-container').style.display = 'block';
                        
                        // Set editor content after a small delay to ensure editor is ready
                        setTimeout(() => {
                                if (window.editorInstance) {
                                        console.log('Setting existing message content...');
                                        window.editorInstance.setData(btn.getAttribute('data-message-content'));
                                        
                                        // Set the message_id in the hidden input for saving
                                        const messageIdInput = document.querySelector('input[name="message_id"]');
                                        if (messageIdInput) {
                                                messageIdInput.value = btn.getAttribute('data-message-id');
                                                console.log('Message ID set to:', btn.getAttribute('data-message-id'));
                                        } else {
                                                console.log('Message ID input not found');
                                        }
                                        
                                        // Set the degreeCode and week_released in the input fields when loaded in 
                                        const degreeCodeInput = document.getElementById('degreecode');
                                        const weekReleasedInput = document.getElementById('weekreleased');
                                        
                                        if (degreeCodeInput) {
                                                degreeCodeInput.value = btn.getAttribute('data-degree-code');
                                                console.log('Degree Code set to:', btn.getAttribute('data-degree-code'));
                                        } else {
                                                console.log('Degree Code input not found');
                                        }
                                        
                                        if (weekReleasedInput) {
                                                weekReleasedInput.value = btn.getAttribute('data-week-released');
                                                console.log('Week Released set to:', btn.getAttribute('data-week-released'));
                                        } else {
                                                console.log('Week Released input not found');
                                        }
                                        
                                } else {
                                        console.log('Editor instance not found for editing');
                                        // Try alternative access
                                        const editorElement = document.querySelector('#editor');
                                        if (editorElement && editorElement.ckeditorInstance) {
                                                editorElement.ckeditorInstance.setData(btn.getAttribute('data-message-content'));
                                        }
                                }
                        }, 200);
                        });
                });
                });
                </script>
                </body>
{% endblock %}